<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
  <title>VR room</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
  <!-- <script src="https://rawgit.com/tizzle/aframe-orbit-controls-component/master/dist/aframe-orbit-controls-component.min.js"></script> -->
  <!-- <script src="https://rawgit.com/archilogic-com/3dio-js/architectural-toolkit/build/3dio.js"></script> -->
  <script src="https://dist.3d.io/3dio-js/2.x.x/3dio.min.js"></script>
  <script src="lib/aframe-template-component.js"></script>
  <script src="lib/TrackedObj.js"></script>
  <!-- <link rel="stylesheet" href="style.css"></style> -->
  <script src="/socket.io/socket.io.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.0.2/peerjs.min.js"></script>

  <script>
    const peer = new Peer('someid', {host: 'localhost', port: 9000, path: '/myapp'});
  </script>

  <script>
    // const socket = io() // io.connect('http://localhost:8080/')

    const mocap = true
    let x = 2
    // socket.on('frame', (data) => {
    //   if (!mocap) {
    //     x = x-0.01
    //     document.querySelector('#camera').object3D.position.set(x, 1.5, 2)
    //     return
    //   }

    //   let bodies = data.components['6dEuler'].rigidBodies
    //   let camera = bodies[4]
    //   //console.log(camera)
    //   if (camera) {
    //     document.querySelector('#camera').object3D.position.set(camera.x/1000.0, camera.z/1000.0, camera.y/1000.0)
    //     document.querySelector('#camera').object3D.rotation.set(camera.euler2 * Math.PI / -180.0, camera.euler3 * Math.PI / 180.0, camera.euler1 * Math.PI / -180.0)
    //     //console.log(document.querySelector('#camera').object3D)
    //   }
    //   let robot = bodies[3]
    //   if (robot) {
    //     document.querySelector('#robot1').object3D.position.set(robot.x/1000.0, robot.z/1000.0, robot.y/1000.0)
    //   }
    //   let table = bodies[2]
    //   if (table) {
    //     document.querySelector('#table').object3D.position.set(table.x/1000.0, table.z/1000.0, table.y/1000.0)
    //   }
    // })

    Handlebars.registerHelper("add", function(lvalue, rvalue, options) {
      lvalue = parseFloat(lvalue);
      rvalue = parseFloat(rvalue);

      return lvalue + rvalue;
    });
    initSockets();
  </script>
</head>
<body>
  <a-scene io3d-lighting anti-alias="true" vr-mode-ui="enabled: true">

    <!-- <a-entity tracked-obj="objID: 4; xMult: 1; yMult: 1; zMult: -1">
      <a-entity rotation="0 0 0">
        <a-entity rotation="0 0 0">
          <a-entity position="0 -1.6 0">
            <a-entity id="camera"  camera="active: true" data-aframe-default-camera></a-entity>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-entity> -->
    <!-- <a-entity id="camera" tracked-obj="objID: 4" camera="active: true" look-controls wasd-controls position="3 1.5 3" data-aframe-default-camera></a-entity> -->

    <a-entity tracked-obj="objID: 4; xMult: 1; yMult: 1; zMult: 1">
        <a-entity id="rig" rotation="0 90 0">
          <a-entity id="camera" camera></a-entity>
        </a-entity>
    </a-entity>  

    <a-entity id="office" template="src: components/layout1.hbs; type: handlebars" data-length="6.25" position="-4.3 0 -.9" ></a-entity>

    <a-entity id="furniture" template="src: components/furniture.html; type: handlebars" position="-2.2 0 -.3" ></a-entity>

    <a-box id="robot1" tracked-obj="objID: 3" color="tomato" depth=".25" height=".25" width=".25" position="2 .25 3"></a-box>

    <!-- <a-camera></a-camera> -->
    <!-- <a-entity id="target" position="5 0.1 3"></a-entity> -->

    <!-- <a-entity id="cam" camera="" position="0 10 10" orbit-controls="invertZoom: true; autoRotate: false; target: #target; enableDamping: true; dampingFactor: 0.1;minDistance:4;maxDistance:100;maxPolarAngle:1.8; enableKeys: true; autoVRLookCam: true; maxPolarAngle: 1.57"></a-entity> -->
  </a-scene>
</body>
</html>
