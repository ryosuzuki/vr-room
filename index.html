<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
  <title>VR room</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
  <!-- <script src="https://rawgit.com/tizzle/aframe-orbit-controls-component/master/dist/aframe-orbit-controls-component.min.js"></script> -->
  <!-- <script src="https://rawgit.com/archilogic-com/3dio-js/architectural-toolkit/build/3dio.js"></script> -->
  <script src="https://dist.3d.io/3dio-js/2.x.x/3dio.min.js"></script>
  <script src="lib/aframe-template-component.js"></script>
  <!-- <link rel="stylesheet" href="style.css"></style> -->
  <script src="/socket.io/socket.io.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.0.2/peerjs.min.js"></script>
  <script src="lib/aframe-teleport-controls.js"></script>

  <script>
    const socket = io() // io.connect('http://localhost:8080/')

    const mocap = false
    let x = 2
    socket.on('frame', (data) => {
      if (!mocap) {
        x = x-0.01
        document.querySelector('#camera').object3D.position.set(x, 1.5, 2)
        return
      }

      let bodies = data.components['6dEuler'].rigidBodies
      let body = bodies[0]
      if (body) {
        document.querySelector('#camera').object3D.position.set(body.x/1000.0, body.z/1000.0, body.y/1000.0)
      }
    })

    Handlebars.registerHelper("add", function(lvalue, rvalue, options) {
      lvalue = parseFloat(lvalue);
      rvalue = parseFloat(rvalue);

      return lvalue + rvalue;
    });
  </script>
</head>
<body>
  <a-scene io3d-lighting anti-alias="true" vr-mode-ui="enabled: true">

    <a-entity id="cameraRig">
      <!-- camera -->
      <a-entity id="camera" camera wasd-controls look-controls position="3 1.5 3" data-aframe-default-camera></a-entity>
      <!-- hand controls -->
      <a-entity id="left-hand" teleport-controls="cameraRig: #cameraRig; teleportOrigin: #camera;"></a-entity>
      <a-entity id="right-hand" teleport-controls="cameraRig: #cameraRig; teleportOrigin: #camera;"></a-entity>
    </a-entity>

    <a-entity laser-controls="hand: right" daydream-controls="" gearvr-controls="" oculus-go-controls="" oculus-touch-controls="" vive-controls="" vive-focus-controls="" windows-motion-controls="" teleport-controls></a-entity>

    <!-- <a-entity id="camera" camera="active: true" look-controls wasd-controls position="3 1.5 3" data-aframe-default-camera></a-entity> -->

    <a-entity id="office" template="src: components/layout1.hbs; type: handlebars" data-length="6.25" position="-2 0 -0.7"></a-entity>

    <a-entity id="furniture" template="src: components/furniture.html; type: handlebars"></a-entity>

    <!-- <a-camera></a-camera> -->
    <!-- <a-entity id="target" position="5 0.1 3"></a-entity> -->

    <!-- <a-entity id="cam" camera="" position="0 10 10" orbit-controls="invertZoom: true; autoRotate: false; target: #target; enableDamping: true; dampingFactor: 0.1;minDistance:4;maxDistance:100;maxPolarAngle:1.8; enableKeys: true; autoVRLookCam: true; maxPolarAngle: 1.57"></a-entity> -->
  </a-scene>
</body>
</html>
